import datetime
import os
import platform
import time

# DADOS DOS VEREADORES (COM ASPAS NAS DATAS)
VEREADORES = [
    {"nome": "Dayana Soares (PDT)", "nasc": "1979-06-08", "apelidos": ["dayana", "day"]},
    {"nome": "Denner Senhor (PL)", "nasc": "1983-02-26", "apelidos": ["denner", "senhor"]},
    {"nome": "Eduardo Signor (UB)", "nasc": "1994-12-23", "apelidos": ["eduardo", "signor"]},
    {"nome": "Fabiana Otoni (PP)", "nasc": "1982-02-12", "apelidos": ["fabiana", "otoni"]},
    {"nome": "Leandro Colleraus (PDT)", "nasc": "1979-03-05", "apelidos": ["leandro", "colleraus"]},
    {"nome": "Paulo Flores (PDT)", "nasc": "1969-05-18", "apelidos": ["paulo", "flores"]},
    {"nome": "Tomas Fiuza (PP)", "nasc": "1989-10-17", "apelidos": ["tomas", "fiuza"]},
]

CARGOS = ["PRESIDENTE", "VICE-PRESIDENTE", "1º SECRETÁRIO", "2º SECRETÁRIO"]
TOTAL_VOTOS = 9

def limpar_tela():
    sistema = platform.system()
    if sistema == "Windows":
        os.system('cls')
    else:
        os.system('clear')

def calcular_idade(data_nasc):
    nasc = datetime.datetime.strptime(data_nasc, "%Y-%m-%d").date()
    hoje = datetime.date.today()
    return (hoje - nasc).days # Dias totais de vida

def identificar_candidato(texto):
    texto = texto.lower().strip()
    if texto in ["nulo", "branco", "0"]:
        return {"nome": "NULO/BRANCO", "nasc": "0001-01-01"}
    
    matches = []
    for v in VEREADORES:
        if texto in v["nome"].lower() or any(a in texto for a in v["apelidos"]):
            matches.append(v)
    
    return matches[0] if len(matches) == 1 else None

def main():
    limpar_tela()
    print("=== SISTEMA DE APURAÇÃO MESA 2026 ===")
    input("Pressione Enter para iniciar...")

    for cargo in CARGOS:
        votos = []
        while len(votos) < TOTAL_VOTOS:
            limpar_tela()
            print(f">> VOTAÇÃO: {cargo}")
            print(f"Votos: {len(votos)}/{TOTAL_VOTOS}\n")
            
            # Placar parcial
            contagem = {}
            for v in votos: contagem[v['nome']] = contagem.get(v['nome'], 0) + 1
            for nome, qtd in sorted(contagem.items(), key=lambda x: x[1], reverse=True):
                print(f"{nome}: {qtd}")
            
            entrada = input(f"\nDigite o voto #{len(votos)+1}: ").strip()
            if not entrada: continue
            
            candidato = identificar_candidato(entrada)
            if candidato:
                if input(f"Confirmar {candidato['nome']}? (S/N): ").lower() == 's':
                    votos.append(candidato)
            else:
                print("Não identificado. Tente novamente.")
                time.sleep(1)

        # Resultado Final do Cargo
        limpar_tela()
        print(f"=== RESULTADO: {cargo} ===")
        contagem = {}
        mapa = {}
        for v in votos:
            contagem[v['nome']] = contagem.get(v['nome'], 0) + 1
            mapa[v['nome']] = v
            
        ranking = sorted(contagem.items(), key=lambda x: x[1], reverse=True)
        vencedor = ranking[0]
        
        # Desempate
        empatados = [r for r in ranking if r[1] == vencedor[1]]
        if len(empatados) > 1:
            print("\nEMPATE! Aplicando critério de idade (Mais Velho)...")
            candidatos_empate = [mapa[e[0]] for e in empatados if e[0] != "NULO/BRANCO"]
            if candidatos_empate:
                candidatos_empate.sort(key=lambda x: calcular_idade(x["nasc"]), reverse=True)
                print(f"Vencedor por idade: {candidatos_empate[0]['nome']}")
        
        input("\nPressione Enter para próximo cargo...")

if __name__ == "__main__":
    main()
