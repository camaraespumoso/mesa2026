<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mesa Diretora 2026 - Apuração Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        
        /* Estilos Gerais de Tela */
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .card { background: white; border-radius: 16px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .btn-voto { transition: all 0.15s ease; }
        .btn-voto:active { transform: scale(0.98); }
        
        /* Animações */
        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
        .animate-slide-up { animation: slideUp 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* ESTILOS DE IMPRESSÃO (Ata) */
        @media print {
            @page { margin: 1.5cm; size: A4; }
            body { background: white; color: black; -webkit-print-color-adjust: exact; }
            
            /* Esconde tudo que não é o relatório final */
            header, aside, #tela-votacao, #tela-resultado, button, .no-print { display: none !important; }
            
            /* Configura a área de relatório para ocupar tudo */
            main, section, #tela-final { 
                width: 100% !important; 
                height: auto !important; 
                overflow: visible !important; 
                position: static !important;
                padding: 0 !important;
                margin: 0 !important;
                box-shadow: none !important;
                border: none !important;
            }

            /* Estilo da Tabela de Impressão */
            .tabela-ata {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
                font-size: 12pt;
            }
            .tabela-ata th {
                background-color: #e2e8f0 !important;
                color: #0f172a !important;
                font-weight: bold;
                border: 1px solid #000;
                padding: 8px;
                text-align: left;
            }
            .tabela-ata td {
                border: 1px solid #000;
                padding: 8px;
            }
            
            /* Cabeçalho da Ata */
            .ata-header {
                text-align: center;
                margin-bottom: 30px;
                border-bottom: 2px solid #000;
                padding-bottom: 10px;
            }
            .ata-logo { font-size: 16pt; font-weight: bold; text-transform: uppercase; }
            .ata-sub { font-size: 10pt; }

            /* Assinaturas */
            .assinaturas {
                margin-top: 50px;
                display: flex;
                justify-content: space-between;
                page-break-inside: avoid;
            }
            .assinatura-box {
                border-top: 1px solid #000;
                width: 40%;
                text-align: center;
                padding-top: 5px;
                font-size: 10pt;
            }
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden bg-slate-50 text-slate-800">

    <!-- Cabeçalho Institucional (Tela) -->
    <header class="bg-white border-b border-slate-200 h-16 flex-shrink-0 z-20">
        <div class="w-full px-6 h-full flex justify-between items-center"> <!-- Full width header -->
            <div class="flex items-center gap-4">
                <div class="bg-blue-700 text-white font-black text-xl p-2 rounded-lg shadow-lg shadow-blue-200">
                    MESA DIRETORA <span class="text-blue-300">26</span>
                </div>
                <div>
                    <h1 class="text-lg font-bold text-slate-800 leading-tight">Sistema de Apuração</h1>
                    <p class="text-xs text-slate-500 font-medium uppercase tracking-wider">Câmara Municipal de Espumoso/RS</p>
                </div>
            </div>
            <div class="flex items-center gap-4 bg-slate-100 px-4 py-2 rounded-full">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <div id="relogio" class="font-mono text-sm font-bold text-slate-600">00:00:00</div>
            </div>
        </div>
    </header>

    <!-- Corpo Principal (OCUPANDO TODA A TELA) -->
    <main class="flex-grow w-full px-4 py-4 flex gap-4 h-[calc(100vh-64px)]">
        
        <!-- Área Central (Votação) - 75% da Tela -->
        <section class="w-3/4 flex flex-col h-full overflow-y-auto pb-2">
            
            <!-- TELA 1: VOTAÇÃO ATIVA -->
            <div id="tela-votacao" class="card p-8 border-t-8 border-blue-600 animate-fade-in flex flex-col h-full">
                <div class="flex justify-between items-end mb-6">
                    <div>
                        <span class="text-sm font-bold text-blue-600 uppercase tracking-widest mb-1 block">Em Apuração</span>
                        <h2 id="cargo-titulo" class="text-5xl font-black text-slate-900">Cargo Atual</h2>
                    </div>
                    <div class="text-right">
                        <span id="contador-votos" class="inline-block bg-slate-900 text-white text-lg font-bold px-6 py-2 rounded-full shadow-md">
                            Voto 1 de 9
                        </span>
                    </div>
                </div>

                <div class="w-full bg-slate-100 rounded-full h-4 mb-8 overflow-hidden">
                    <div id="barra-progresso" class="bg-blue-600 h-full rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>

                <div class="flex-grow bg-slate-50 rounded-2xl p-6 border border-slate-200 overflow-y-auto">
                    <p class="text-base font-bold text-slate-500 mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-hand-pointer"></i> Clique no candidato para registrar o voto:
                    </p>
                    <div id="grid-candidatos" class="grid grid-cols-3 gap-4">
                        <!-- Botões JS -->
                    </div>
                </div>

                <div class="mt-6 flex gap-4">
                    <button onclick="registrarVoto('NULO')" class="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-5 text-lg rounded-xl transition border border-slate-300">
                        BRANCO / NULO
                    </button>
                    <button onclick="desfazerVoto()" class="px-10 bg-white border-2 border-red-100 text-red-600 hover:bg-red-50 font-bold text-lg rounded-xl transition flex items-center gap-2">
                        <i class="fa-solid fa-rotate-left"></i> Desfazer
                    </button>
                </div>
            </div>

            <!-- TELA 2: RESULTADO PARCIAL -->
            <div id="tela-resultado" class="hidden card p-10 text-center border-t-8 border-green-500 animate-slide-up h-full flex flex-col justify-center items-center">
                <div class="mb-6 bg-green-100 w-32 h-32 rounded-full flex items-center justify-center mx-auto text-green-600 shadow-inner">
                    <i class="fa-solid fa-check text-6xl"></i>
                </div>
                <h2 class="text-4xl font-bold text-slate-800 mb-4">Votação Encerrada</h2>
                <div class="bg-gradient-to-b from-slate-50 to-white border border-slate-200 p-10 rounded-3xl shadow-lg w-full max-w-2xl mx-auto mb-8 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-2 bg-green-500"></div>
                    <p class="text-sm font-bold text-green-600 uppercase tracking-widest mb-3">Eleito</p>
                    <h1 id="res-nome" class="text-6xl font-black text-slate-900 mb-4 leading-tight">Nome</h1>
                    <div id="res-motivo" class="inline-flex items-center gap-2 bg-green-100 text-green-800 px-4 py-2 rounded-full text-sm font-bold uppercase">
                        Motivo
                    </div>
                    <div id="area-detalhe-empate" class="hidden mt-8 pt-6 border-t border-slate-200 text-left bg-white p-4 rounded-xl shadow-inner">
                        <p class="text-sm font-bold text-slate-500 uppercase mb-3">Análise de Desempate</p>
                        <div id="lista-desempate" class="space-y-3 text-base"></div>
                    </div>
                </div>
                <button onclick="proximoCargo()" class="bg-blue-600 hover:bg-blue-700 text-white text-xl font-bold py-5 px-16 rounded-2xl shadow-xl transition transform hover:-translate-y-1 flex items-center gap-3">
                    Próximo Cargo <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>

            <!-- TELA 3: RELATÓRIO FINAL (ATA) -->
            <div id="tela-final" class="hidden card p-12 animate-fade-in h-full overflow-y-auto bg-white">
                
                <!-- Cabeçalho de Impressão -->
                <div class="ata-header">
                    <div class="ata-logo text-2xl">Câmara Municipal de Vereadores de Espumoso/RS</div>
                    <div class="ata-sub text-lg">Estado do Rio Grande do Sul</div>
                    <h2 class="text-3xl font-bold mt-6 uppercase">ATA DE APURAÇÃO ELETRÔNICA</h2>
                    <p class="text-lg mt-2">Eleição da Mesa Diretora - Exercício 2026</p>
                    <p class="text-base text-slate-500 mt-2" id="data-impressao"></p>
                </div>

                <div class="mt-8">
                    <table class="tabela-ata w-full">
                        <thead>
                            <tr>
                                <th style="width: 25%">CARGO</th>
                                <th style="width: 30%">CANDIDATO ELEITO</th>
                                <th style="width: 15%">VOTOS</th>
                                <th style="width: 30%">OBSERVAÇÃO / CRITÉRIO</th>
                            </tr>
                        </thead>
                        <tbody id="corpo-tabela-ata">
                            <!-- Linhas geradas via JS -->
                        </tbody>
                    </table>
                </div>

                <div class="assinaturas hidden print:flex text-lg">
                    <div class="assinatura-box">
                        _______________________________________<br>
                        <b>Presidente da Sessão</b>
                    </div>
                    <div class="assinatura-box">
                        _______________________________________<br>
                        <b>Secretário Geral</b>
                    </div>
                </div>

                <div class="mt-10 pt-6 border-t border-slate-200 flex justify-end no-print">
                    <button onclick="window.print()" class="bg-slate-800 text-white px-8 py-4 rounded-xl hover:bg-slate-700 font-bold flex items-center gap-3 shadow-xl text-lg">
                        <i class="fa-solid fa-print"></i> Imprimir Ata Oficial
                    </button>
                </div>
            </div>

        </section>

        <!-- Área Lateral (Placar e Histórico) - 25% da Tela -->
        <aside class="w-1/4 flex flex-col gap-4 h-full no-print min-w-[300px]">
            
            <!-- Placar Ao Vivo (50% da Altura) -->
            <div class="card p-6 flex flex-col shadow-lg border border-slate-200 bg-white h-1/2">
                <div class="flex justify-between items-center mb-6 border-b-2 border-slate-100 pb-4">
                    <h3 class="text-sm font-black text-slate-500 uppercase tracking-widest">Placar Ao Vivo</h3>
                    <span class="text-[10px] font-bold text-white bg-red-500 px-3 py-1 rounded-full animate-pulse">AO VIVO</span>
                </div>
                <div id="placar-lista" class="flex-grow overflow-y-auto space-y-5 pr-2">
                    <p class="text-center text-slate-400 text-base py-10 italic">Aguardando votos...</p>
                </div>
                <div id="box-empate" class="hidden mt-6 bg-amber-50 border-l-4 border-amber-500 rounded-r-lg p-4 animate-pulse shadow-sm">
                    <div class="flex gap-3 items-start">
                        <div class="text-amber-600 text-xl mt-1"><i class="fa-solid fa-scale-balanced"></i></div>
                        <div>
                            <h4 class="text-sm font-bold text-amber-800 uppercase">Empate Parcial</h4>
                            <p class="text-xs text-amber-700 mt-1">Critério de idade será aplicado se persistir ao final.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Histórico (50% da Altura) - AUMENTADO -->
            <div class="card p-6 h-1/2 overflow-y-auto border border-slate-200 bg-slate-50">
                <h3 class="text-xs font-bold text-slate-400 uppercase mb-4 flex items-center gap-2 sticky top-0 bg-slate-50 pb-2 border-b border-slate-200 z-10">
                    <i class="fa-solid fa-clock-rotate-left"></i> Histórico da Mesa
                </h3>
                <div id="historico-lista" class="space-y-3">
                    <p class="text-center text-slate-400 text-sm italic py-2">Nenhum cargo definido.</p>
                </div>
            </div>

        </aside>

    </main>

    <script>
        // --- DADOS ---
        // cargo_atual: 0=Nenhum, 1=Pres, 2=Vice, 3=Geral, 4=Adjunto
        const VEREADORES = [
            {id: 1, nome: "Dayana Soares (PDT)", nasc: "1979-06-08", cargo_atual: 4}, // Atual Adjunta
            {id: 2, nome: "Denner Senhor (PL)", nasc: "1983-02-26", cargo_atual: 3},  // Atual Geral
            {id: 3, nome: "Eduardo Signor (UB)", nasc: "1994-12-23", cargo_atual: 0},
            {id: 4, nome: "Fabiana Otoni (PP)", nasc: "1982-02-12", cargo_atual: 0},
            {id: 5, nome: "Leandro Colleraus (PDT)", nasc: "1979-03-05", cargo_atual: 0},
            {id: 6, nome: "Paulo Flores (PDT)", nasc: "1969-05-18", cargo_atual: 2}, // Atual Vice
            {id: 7, nome: "Tomas Fiuza (PP)", nasc: "1989-10-17", cargo_atual: 1}, // Atual Presidente
        ];
        
        // NOMENCLATURA CORRIGIDA (REGIMENTAL)
        const CARGOS = ["PRESIDENTE", "VICE-PRESIDENTE", "SECRETÁRIO GERAL", "SECRETÁRIO ADJUNTO"];
        
        let estado = { indiceCargo: 0, votos: [], resultados: [] };

        // --- LÓGICA DE DATA ---
        function formatarData(s) { const [a,m,d] = s.split('-'); return `${d}/${m}/${a}`; }
        function calcularDiasVida(s) { return new Date(s).getTime(); }
        function calcularIdadeTexto(s) {
            const hj = new Date(); const ns = new Date(s);
            let an = hj.getFullYear() - ns.getFullYear();
            const m = hj.getMonth() - ns.getMonth();
            if (m < 0 || (m===0 && hj.getDate() < ns.getDate())) an--;
            return `${an} anos`;
        }

        // --- LÓGICA DE ELEGIBILIDADE (REGRAS RÍGIDAS) ---
        function isElegivel(vereador, indiceCargoDisputa) {
            const cargoAlvo = indiceCargoDisputa + 1; 
            const cargoAtual = vereador.cargo_atual;

            if (cargoAtual === 0) return true;
            if (cargoAtual === cargoAlvo) return false; // Reeleição
            if (cargoAlvo > cargoAtual) return false; // Cargo Inferior
            return true;
        }

        // --- APP ---
        function iniciar() {
            setInterval(() => document.getElementById('relogio').innerText = new Date().toLocaleTimeString('pt-BR'), 1000);
            carregarCargo();
        }

        function carregarCargo() {
            estado.votos = [];
            document.getElementById('tela-votacao').classList.remove('hidden');
            document.getElementById('tela-resultado').classList.add('hidden');
            document.getElementById('box-empate').classList.add('hidden');
            document.getElementById('cargo-titulo').innerText = CARGOS[estado.indiceCargo];
            atualizarUI();
            gerarBotoes();
        }

        function gerarBotoes() {
            const grid = document.getElementById('grid-candidatos');
            grid.innerHTML = '';
            
            const eleitosAnteriores = estado.resultados.map(r => r.vencedor);
            
            VEREADORES.forEach(v => {
                if (eleitosAnteriores.includes(v.nome)) return;
                if (!isElegivel(v, estado.indiceCargo)) return;

                const btn = document.createElement('button');
                btn.className = "bg-white hover:bg-blue-50 hover:border-blue-600 border-2 border-slate-200 p-6 rounded-2xl flex flex-col items-start justify-center shadow-sm hover:shadow-md transition group text-left h-full";
                btn.onclick = () => registrarVoto(v);
                const ini = v.nome.split(' ').map(n=>n[0]).join('').substring(0,2);
                btn.innerHTML = `
                    <div class="flex items-center gap-3 mb-2 w-full">
                        <div class="w-12 h-12 rounded-full bg-slate-100 text-slate-600 font-bold flex items-center justify-center text-lg group-hover:bg-blue-600 group-hover:text-white transition flex-shrink-0">${ini}</div>
                        <div class="text-[10px] text-slate-400 uppercase font-bold tracking-widest">Candidato</div>
                    </div>
                    <div class="font-bold text-slate-800 text-lg leading-tight group-hover:text-blue-700">${v.nome}</div>
                `;
                grid.appendChild(btn);
            });
        }

        function registrarVoto(c) {
            if (estado.votos.length >= 9) return;
            estado.votos.push(c === 'NULO' ? { nome: "NULO / BRANCO", id: 0, nasc: "9999-12-31" } : c);
            atualizarUI();
            if (estado.votos.length === 9) setTimeout(processarResultado, 500);
        }

        function desfazerVoto() {
            if (estado.votos.length > 0) { estado.votos.pop(); atualizarUI(); }
        }

        function atualizarUI() {
            const total = 9; const atual = estado.votos.length; const pct = (atual / total) * 100;
            document.getElementById('barra-progresso').style.width = `${pct}%`;
            
            const contador = document.getElementById('contador-votos');
            contador.innerText = atual < 9 ? `Voto ${atual + 1} de 9` : "Computando...";
            contador.className = atual < 9 ? "inline-block bg-slate-900 text-white text-lg font-bold px-6 py-2 rounded-full shadow-md" : "inline-block bg-green-600 text-white text-lg font-bold px-6 py-2 rounded-full animate-pulse shadow-md";

            const lista = document.getElementById('placar-lista'); lista.innerHTML = '';
            const contagem = {}; estado.votos.forEach(v => contagem[v.nome] = (contagem[v.nome]||0)+1);
            const ord = Object.entries(contagem).sort((a,b) => b[1] - a[1]);

            const boxEmpate = document.getElementById('box-empate');
            if (ord.length > 1 && ord[0][1] === ord[1][1]) boxEmpate.classList.remove('hidden');
            else boxEmpate.classList.add('hidden');

            if (ord.length === 0) { lista.innerHTML = '<p class="text-center text-slate-400 text-base py-10 italic">Aguardando o primeiro voto...</p>'; return; }

            ord.forEach(([nm, qtd]) => {
                const p = (qtd/9)*100; const isLider = qtd === ord[0][1];
                lista.innerHTML += `
                    <div class="mb-4 animate-fade-in">
                        <div class="flex justify-between items-end mb-2">
                            <span class="text-sm font-bold ${isLider?'text-blue-700':'text-slate-500'} truncate pr-2">${nm}</span>
                            <span class="text-6xl font-black ${isLider?'text-blue-800':'text-slate-400'}">${qtd}</span>
                        </div>
                        <div class="w-full bg-slate-100 h-4 rounded-full overflow-hidden shadow-inner">
                            <div class="h-full ${isLider?'bg-blue-600':'bg-slate-300'} transition-all duration-300" style="width: ${p}%"></div>
                        </div>
                    </div>`;
            });
        }

        function processarResultado() {
            const contagem = {}; const mapa = {};
            estado.votos.forEach(v => { contagem[v.nome] = (contagem[v.nome]||0)+1; mapa[v.nome] = v; });
            const ord = Object.entries(contagem).sort((a,b) => b[1] - a[1]);
            const prim = ord[0]; const emp = ord.filter(i => i[1] === prim[1]);

            let venc = "", mot = "", htmlD = "";
            if (emp.length === 1) {
                venc = prim[0]; mot = "Maioria Simples";
                document.getElementById('area-detalhe-empate').classList.add('hidden');
            } else {
                const cEmp = emp.filter(e => e[0] !== "NULO / BRANCO").map(e => mapa[e[0]]);
                if (cEmp.length === 0) { venc = "NENHUM"; mot = "Empate Nulo"; }
                else {
                    cEmp.sort((a, b) => calcularDiasVida(a.nasc) - calcularDiasVida(b.nasc));
                    venc = cEmp[0].nome; mot = "Critério de Idade (Mais Velho)";
                    htmlD = cEmp.map((c, i) => `
                        <div class="flex justify-between items-center border-b border-slate-100 last:border-0 py-2 ${i===0?'text-green-700 font-bold':'text-slate-500'}">
                            <span>${i+1}º ${c.nome}</span>
                            <span class="text-sm">${calcularIdadeTexto(c.nasc)}</span>
                        </div>`).join('');
                    const area = document.getElementById('area-detalhe-empate');
                    document.getElementById('lista-desempate').innerHTML = htmlD; area.classList.remove('hidden');
                }
            }

            estado.resultados.push({ cargo: CARGOS[estado.indiceCargo], vencedor: venc, votos: prim[1], motivo: mot });
            document.getElementById('tela-votacao').classList.add('hidden');
            document.getElementById('tela-resultado').classList.remove('hidden');
            document.getElementById('res-nome').innerText = venc;
            document.getElementById('res-motivo').innerText = mot;
            atualizarHistorico();
        }

        function atualizarHistorico() {
            const div = document.getElementById('historico-lista');
            if (estado.resultados.length === 0) return;
            div.innerHTML = '';
            estado.resultados.forEach(res => {
                div.innerHTML += `
                    <div class="bg-white p-4 rounded-xl border-l-4 border-green-500 shadow-sm mb-3">
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">${res.cargo}</p>
                        <p class="font-bold text-slate-800 text-lg leading-tight">${res.vencedor}</p>
                        <div class="flex justify-between items-center mt-2">
                            <span class="text-sm font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded border border-slate-200">${res.votos} votos</span>
                            <i class="fa-solid fa-check-circle text-green-500 text-xl"></i>
                        </div>
                    </div>`;
            });
        }

        function proximoCargo() {
            estado.indiceCargo++;
            if (estado.indiceCargo < CARGOS.length) carregarCargo();
            else gerarRelatorioFinal();
        }

        function gerarRelatorioFinal() {
            document.getElementById('tela-resultado').classList.add('hidden');
            document.getElementById('tela-final').classList.remove('hidden');
            // Esconde lateral para ocupar 100%
            document.querySelector('aside').classList.add('hidden');
            const m = document.querySelector('section'); 
            m.classList.remove('w-3/4'); 
            m.classList.add('w-full');

            document.getElementById('data-impressao').innerText = `Emitido em: ${new Date().toLocaleString('pt-BR')}`;
            const tbody = document.getElementById('corpo-tabela-ata');
            tbody.innerHTML = '';

            estado.resultados.forEach(res => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${res.cargo}</td>
                    <td style="font-weight: bold; font-size: 1.1em;">${res.vencedor}</td>
                    <td>${res.votos} (${((res.votos/9)*100).toFixed(1)}%)</td>
                    <td>${res.motivo}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        iniciar();
    </script>
</body>
</html>